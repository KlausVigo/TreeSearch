<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inapplicable data in morphological phylogenetics • TreeSearch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Inapplicable data in morphological phylogenetics">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreeSearch</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.2.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/filesystem-navigation.html">File system navigation in R</a>
    </li>
    <li>
      <a href="../articles/getting-started.html">Installing R and TreeSearch</a>
    </li>
    <li>
      <a href="../articles/inapplicable.html">Inapplicable data in morphological phylogenetics</a>
    </li>
    <li>
      <a href="../articles/load-data.html">Loading phylogenetic data into R</a>
    </li>
    <li>
      <a href="../articles/load-trees.html">Loading phylogenetic trees into R</a>
    </li>
    <li>
      <a href="../articles/profile-scores.html">Concavity profiles with Profile Parsimony</a>
    </li>
    <li>
      <a href="../articles/profile.html">Tree Search with Profile Parsimony</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ms609/TreeSearch">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Inapplicable data in morphological phylogenetics</h1>
                        <h4 class="author">Martin R. Smith</h4>
            
            <h4 class="date">2019-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/TreeSearch/blob/master/vignettes/inapplicable.Rmd"><code>vignettes/inapplicable.Rmd</code></a></small>
      <div class="hidden name"><code>inapplicable.Rmd</code></div>

    </div>

    
    
<p><code>TreeSearch</code> is an R package that allows, among other things, parsimony search on morphological datasets that contain inapplicable data, following the algorithm proposed by Brazeau, Guillerme and Smith <span class="citation">(2019)</span>.</p>
<p>In brief, this algorithm modifies the Fitch algorithm to count the total number of homoplasious events on a tree.</p>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p><a href="getting-started.html">A companion vignette</a> gives details on installing the package and getting up and running.</p>
<!--
# message=FALSE will suppress message when loading TreeSearch
# Temporary fix until R.oo is updated -- remove thereafter
# https://github.com/r-lib/rlang/issues/669
-->
<p>Once installed, load the inapplicable package into R using</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'TreeSearch'</span>)</a></code></pre></div>
</div>
<div id="scoring-a-tree-and-conducting-a-tree-search" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-a-tree-and-conducting-a-tree-search" class="anchor"></a>Scoring a tree, and conducting a tree search</h2>
<p>Here’s an example of using the package to conduct tree search. You can <a href="load-data.html">load your own dataset</a>, but for now, we’ll use the Vinther <em>et al.</em> <span class="citation">(2008)</span> dataset that comes bundled with the package.</p>
<p>This dataset is small enough that it runs reasonably quickly, but its phylogenetic signal is obscure enough that it can require Ratchet searches to escape from local optima.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">my.data &lt;-<span class="st"> </span>TreeSearch<span class="op">::</span>inapplicable.datasets[[<span class="st">'Vinther2008'</span>]]</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">my.phyDat &lt;-<span class="st"> </span>phangorn<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/phangorn/man/phyDat.html">phyDat</a></span>(my.data, <span class="dt">type=</span><span class="st">'USER'</span>, <span class="dt">levels=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">9</span>, <span class="st">'-'</span>))</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Set a random seed so that random functions in this document are reproducible</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">RNGversion</a></span>(<span class="st">"3.5.0"</span>) <span class="co"># Until we can require R3.6.0</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">0</span>)</a></code></pre></div>
<p>We can generate a random tree and calculate its parsimony score thus:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">random.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/RandomTree.html">RandomTree</a></span>(my.phyDat)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(random.tree)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Random-tree-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/Fitch.html">Fitch</a></span>(random.tree, my.phyDat)</a></code></pre></div>
<pre><code>## [1] 189</code></pre>
<p>We might save some wasted time in tree search if we can start with a tree that’s a little closer to optimal: perhaps a neighbour-joining tree.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">nj.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/NJTree.html">NJTree</a></span>(my.phyDat)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(nj.tree)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Neighbour-joining-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/Fitch.html">Fitch</a></span>(nj.tree, my.phyDat)</a></code></pre></div>
<pre><code>## [1] 85</code></pre>
<p>With the Vinther <em>et al.</em> <span class="citation">(2008)</span> dataset, nemerteans and brachiopods form an natural outgroup to the other taxa. If we wish, we can constrain this outgroup and avoid making tree rearrangements that would mix ingroup and outgroup taxa. This will accelerate tree search, but it’s worth thinking carefully whether you can be perfectly confident that the ingroup and outgroup are mutually monophyletic.</p>
<p>To constrain an outgroup, we first need to make the outgroup and ingroup monophyletic on our tree:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">outgroup &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Nemertean'</span>, <span class="st">'Lingula'</span>, <span class="st">'Terebratulina'</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">rooted.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/EnforceOutgroup.html">EnforceOutgroup</a></span>(nj.tree, outgroup)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rooted.tree)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Outgroup-1.png" width="700"></p>
<p>Now let’s see whether a few nearest-neighbour interchanges can find us a better tree score. This tends to be the quickest search to run, if not the most exhaustive. Using <code>RootedNNISwap</code> instead of <code>NNISwap</code> stops taxa from moving from one side of the root to another, which we need to do if we’re going to enforce our outgroup constraint. Even if we are using a single-taxon outgroup, using <code>RootedNNISwap</code> retains the position of the root, which makes tree comparison and interpretation easier later on.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">better.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TreeSearch.html">TreeSearch</a></span>(<span class="dt">tree=</span>rooted.tree, <span class="dt">dataset=</span>my.phyDat, </a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                           <span class="dt">EdgeSwapper=</span>RootedNNISwap, <span class="dt">verbosity=</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>##   - Performing tree search.  Initial score: 85</code></pre>
<pre><code>##     - Iteration 6 - Best score85 hit 1 times.</code></pre>
<pre><code>##     - Iteration 7 - Best score85 hit 2 times.</code></pre>
<pre><code>##     - Iteration 8 - Best score85 hit 3 times.</code></pre>
<pre><code>##     - Iteration 10 - Best score85 hit 4 times.</code></pre>
<pre><code>##     - Iteration 11 - Best score85 hit 5 times.</code></pre>
<pre><code>##     - Iteration 12 - Best score85 hit 6 times.</code></pre>
<pre><code>##     - Iteration 16 - Best score85 hit 7 times.</code></pre>
<pre><code>##     - Iteration 17 - Best score85 hit 8 times.</code></pre>
<pre><code>##     - Iteration 19 - Best score85 hit 9 times.</code></pre>
<pre><code>##     - Iteration 24 - Best score85 hit 10 times.</code></pre>
<pre><code>##     - Iteration 29 - Best score85 hit 11 times.</code></pre>
<pre><code>##     - Iteration 36 - Best score85 hit 12 times.</code></pre>
<pre><code>##     * Iteration 37 - New best score 84 found on 1 trees.</code></pre>
<pre><code>##     - Iteration 39 - Best score84 hit 2 times.</code></pre>
<pre><code>##     * Iteration 41 - New best score 81 found on 1 trees.</code></pre>
<pre><code>##     - Iteration 42 - Best score81 hit 2 times.</code></pre>
<pre><code>##     - Iteration 43 - Best score81 hit 3 times.</code></pre>
<pre><code>##     - Iteration 49 - Best score81 hit 4 times.</code></pre>
<pre><code>##     - Iteration 50 - Best score81 hit 5 times.</code></pre>
<pre><code>##     - Iteration 54 - Best score81 hit 6 times.</code></pre>
<pre><code>##     - Iteration 55 - Best score81 hit 7 times.</code></pre>
<pre><code>##     - Iteration 57 - Best score81 hit 8 times.</code></pre>
<pre><code>##     - Iteration 62 - Best score81 hit 9 times.</code></pre>
<pre><code>##     - Iteration 63 - Best score81 hit 10 times.</code></pre>
<pre><code>##     - Iteration 69 - Best score81 hit 11 times.</code></pre>
<pre><code>##     - Iteration 81 - Best score81 hit 12 times.</code></pre>
<pre><code>##     - Iteration 82 - Best score81 hit 13 times.</code></pre>
<pre><code>##     * Iteration 83 - New best score 80 found on 1 trees.</code></pre>
<pre><code>##     - Iteration 84 - Best score80 hit 2 times.</code></pre>
<pre><code>##     - Iteration 85 - Best score80 hit 3 times.</code></pre>
<pre><code>##     - Iteration 89 - Best score80 hit 4 times.</code></pre>
<pre><code>##   - Final score 80 found 4 times after 100 rearrangements.</code></pre>
<p>This score is better than the 85 of the original neighbour-joining tree, but is this the best we can do?</p>
<p>Using NNI helps to explore the region of treespace close to the local optimum, but SPR and TBR rearrangements are better at escaping local optima, and find better trees further away in tree space. Using more hits (<code>maxHits</code>) and more iterations (<code>maxIter</code>) also means we’ll move closer to an optimal tree.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">better.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TreeSearch.html">TreeSearch</a></span>(better.tree, my.phyDat, <span class="dt">maxHits=</span><span class="dv">8</span>, <span class="dt">maxIter=</span><span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">                           <span class="dt">EdgeSwapper=</span>RootedSPRSwap, <span class="dt">verbosity=</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   - Performing tree search.  Initial score: 80</code></pre>
<pre><code>##   - Terminating search; hit best score 8 times.</code></pre>
<pre><code>##   - Final score 80 found 8 times after 440 rearrangements.</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">better.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TreeSearch.html">TreeSearch</a></span>(better.tree, my.phyDat, <span class="dt">maxHits=</span><span class="dv">20</span>, <span class="dt">maxIter=</span><span class="dv">40000</span>, </a>
<a class="sourceLine" id="cb49-2" data-line-number="2">                           <span class="dt">EdgeSwapper=</span>RootedTBRSwap, <span class="dt">verbosity=</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   - Performing tree search.  Initial score: 80</code></pre>
<pre><code>##     * Iteration 848 - New best score 79 found on 1 trees.</code></pre>
<pre><code>##   - Terminating search; hit best score 20 times.</code></pre>
<pre><code>##   - Final score 79 found 20 times after 2046 rearrangements.</code></pre>
<p>That score’s looking better, but these are only quick searches, and we could be caught in a local optimum. A more comprehensive search of tree space can be accomplished using the parsimony ratchet <span class="citation">(Nixon, 1999)</span>. It might take a couple of minutes to run.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">best.tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Ratchet.html">Ratchet</a></span>(better.tree, my.phyDat, <span class="dt">verbosity=</span><span class="dv">0</span>, <span class="dt">ratchIter=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb54-2" data-line-number="2">                     <span class="dt">swappers=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(RootedTBRSwap, RootedSPRSwap, RootedNNISwap))</a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(best.tree, <span class="st">'score'</span>) <span class="co"># Each tree is labelled with its score during tree search</span></a></code></pre></div>
<pre><code>## [1] 79</code></pre>
<p>The best tree for this dataset has a score of 79. This relatively quick Ratchet search always seems to find a tree with this score.</p>
<p>Let’s take a look at the one it’s found on this occasion:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(best.tree)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Plot-best-tree-1.png" width="700"></p>
<p>This is, of course, just one most parsimonious tree; with this dataset, there are many.</p>
<p>One way to make a strict consensus of multiple optimal trees is to collect a number of trees from independent Ratchet iterations.</p>
<p>For each Ratchet iteration, we’ll conduct a TBR search to scan tree space, then an NNI search to hone in on the local optimum.</p>
<p>Note that it’s especially important to retain the position of the root here: a single topology, if rooted in different places, can lead to an unresolved consensus.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">some.optimal.trees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Ratchet.html">MultiRatchet</a></span>(best.tree, <span class="dt">nSearch=</span><span class="dv">20</span>, my.phyDat, <span class="dt">swappers=</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2">                                   <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(RootedTBRSwap, RootedNNISwap))</a></code></pre></div>
<pre><code>## Found 15 unique trees from 20 searches.</code></pre>
<p>If ten independent runs ended up at a number of different trees, there may be many more optimal trees out there to be found; perhaps we could repeat <code>MultiRatchet</code> with <code>nSearch = 250</code> for a more exhaustive sampling of tree space. That would take a while though; for now, let’s check out our consensus tree:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2">strict.consensus &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ape/man/consensus.html">consensus</a></span>(some.optimal.trees)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(strict.consensus)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Plot-strict-consensus-1.png" width="700"></p>
<p>We might prefer a majority-rule consensus tree:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2">majority.consensus &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ape/man/consensus.html">consensus</a></span>(some.optimal.trees, <span class="dt">p=</span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(majority.consensus)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Plot-majority-rule-consensus-1.png" width="700"></p>
<p>Clade support can be generated using Jackknife resampling:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">jack.trees &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Ratchet.html">Jackknife</a></span>(best.tree, my.phyDat, <span class="dt">EdgeSwapper=</span>RootedTBRSwap,</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">                        <span class="dt">jackIter=</span><span class="dv">25</span>, <span class="dt">verbosity=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(strict.consensus)</a>
<a class="sourceLine" id="cb61-5" data-line-number="5"></a>
<a class="sourceLine" id="cb61-6" data-line-number="6">jack.support &lt;-<span class="st"> </span><span class="kw"><a href="../reference/SplitFrequency.html">SplitFrequency</a></span>(strict.consensus, jack.trees) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(jack.trees)</a>
<a class="sourceLine" id="cb61-7" data-line-number="7">ape<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">nodelabels</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>, <span class="kw"><a href="https://rdrr.io/r/base/Round.html">signif</a></span>(jack.support, <span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb61-8" data-line-number="8">           <span class="dt">col=</span><span class="kw"><a href="../reference/SupportColour.html">SupportColour</a></span>(jack.support), </a>
<a class="sourceLine" id="cb61-9" data-line-number="9">           <span class="dt">adj=</span><span class="dv">0</span>, <span class="dt">pos=</span><span class="dv">2</span>, <span class="dt">frame=</span><span class="st">'none'</span>)</a></code></pre></div>
<p><img src="inapplicable_files/figure-html/Jackknife-annotations-1.png" width="700"></p>
</div>
<div id="implied-weighting" class="section level2">
<h2 class="hasAnchor">
<a href="#implied-weighting" class="anchor"></a>Implied weighting</h2>
<p>Equal weights produces trees that are less accurate and less precise than implied weights <span class="citation">(Smith, 2019)</span>; equally weighted analysis should never be conducted without also considering the results of implied weights <span class="citation">(Goloboff, 1997)</span>, ideally under a range of concavity constants <span class="citation">(cf. Smith &amp; Ortega-Hernández, 2014)</span>.</p>
<p>The simplest way to conduct an implied weights search is to use the functions</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">IWTreeSearch</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">IWRatchet</a>
<a class="sourceLine" id="cb62-3" data-line-number="3">IWMultiRatchet</a></code></pre></div>
<p>which operate in the same fashion as their equally-weighted counterparts, with the option of specifying a concavity constant (<em>k</em>) using the parameter <code>concavity=k</code> (default = 10). Note that the default value of 10 is somewhat higher than the default of 3 in TNT; this low default probably gives poorer results in many settings <span class="citation">(Smith, 2019)</span>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Brazeau2018">
<p>Brazeau, M. D., Guillerme, T., &amp; Smith, M. R. (2019). An algorithm for morphological phylogenetic analysis with inapplicable data. <em>Systematic Biology</em>, in press. doi:<a href="https://doi.org/10.1093/sysbio/syy083">10.1093/sysbio/syy083</a></p>
</div>
<div id="ref-Goloboff1997">
<p>Goloboff, P. A. (1997). Self-weighted optimization: tree searches and character state reconstructions under implied transformation costs. <em>Cladistics</em>, <em>13</em>(3), 225–245. Retrieved from <a href="http://dx.doi.org/10.1111/j.1096-0031.1997.tb00317.x" class="uri">http://dx.doi.org/10.1111/j.1096-0031.1997.tb00317.x</a></p>
</div>
<div id="ref-Nixon1999">
<p>Nixon, K. C. (1999). The Parsimony Ratchet, a new method for rapid parsimony analysis. <em>Cladistics</em>, <em>15</em>(4), 407–414. doi:<a href="https://doi.org/10.1111/j.1096-0031.1999.tb00277.x">10.1111/j.1096-0031.1999.tb00277.x</a></p>
</div>
<div id="ref-SmithTern">
<p>Smith, M. R. (2019). Bayesian and parsimony approaches reconstruct informative trees from simulated morphological datasets. <em>Biology Letters</em>, <em>15</em>(2), 20180632. doi:<a href="https://doi.org/10.1098/rsbl.2018.0632">10.1098/rsbl.2018.0632</a></p>
</div>
<div id="ref-Smith2014">
<p>Smith, M. R., &amp; Ortega-Hernández, J. (2014). <em>Hallucigenia</em>’s onychophoran-like claws and the case for Tactopoda. <em>Nature</em>, <em>514</em>(7522), 363–366. doi:<a href="https://doi.org/10.1038/nature13576">10.1038/nature13576</a></p>
</div>
<div id="ref-Vinther2008">
<p>Vinther, J., Van Roy, P., &amp; Briggs, D. E. G. (2008). Machaeridians are Palaeozoic armoured annelids. <em>Nature</em>, <em>451</em>(7175), 185–188. doi:<a href="https://doi.org/10.1038/nature06474">10.1038/nature06474</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-started">Getting started</a></li>
      <li><a href="#scoring-a-tree-and-conducting-a-tree-search">Scoring a tree, and conducting a tree search</a></li>
      <li><a href="#implied-weighting">Implied weighting</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://community.dur.ac.uk/martin.smith/">Martin R. Smith</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '8422cbc6478f9d3278ad355b48435342',
    indexName: 'treesearch',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
